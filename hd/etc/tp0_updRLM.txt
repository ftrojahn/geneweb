<!DOCTYPE html>
<html lang="%lang;">
<head>
  <title>[*modify::tree]</title>
  <meta name="robots" content="none"%/>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="%images_prefix;favicon_gwd.png">
  <link rel="apple-touch-icon" href="%images_prefix;favicon_gwd.png">
  %include;css
</head>
<body%body_prop;>
%include;home
%include;hed
%let;mid;%sp;class="align-middle"%in;
%define;one_pvar_line(znz,zocz,zfnz,zsnz,zbdz,ztz,zparamz)
  <trzparamz>
    <td class="align-middle text-center text-nowrap px-3">
      <button type="button" class="btn btn-success btn-sm row_add"
              title="[*add/insert/delete/up/down row]1"
              aria-label="[*add/insert/delete/up/down row aria-label]1">
        <i class="fas fa-plus" aria-hidden="true"></i>
      </button>
      <button type="button" class="btn btn-danger btn-sm row_del"
              title="[*add/insert/delete/up/down row]2"
              aria-label="[*add/insert/delete/up/down row aria-label]2">
        <i class="fas fa-minus" aria-hidden="true"></i>
      </button>
    </td>
    <td class="align-middle text-center text-nowrap pr-3">
      <button type="button" class="btn btn-secondary btn-sm row_move_up"
              title="[*add/insert/delete/up/down row]3"
              aria-label="[*add/insert/delete/up/down row aria-label]3">
        <i class="fas fa-arrow-up" aria-hidden="true"></i>
      </button>
      <button type="button" class="btn btn-secondary btn-sm row_move_down"
              title="[*add/insert/delete/up/down row]4"
              aria-label="[*add/insert/delete/up/down row aria-label]4">
        <i class="fas fa-arrow-down" aria-hidden="true"></i>
      </button>
    </td>
    <td class="align-middle font-weight-bold border-left px-3 line-number"></td>
    <td%mid;><input name="p" class="form-control reset_bd_text" size="30" value="zfnz" aria-label="[*first name/first names]1"></td>
    <td%mid;><input name="n" class="form-control reset_bd_text" size="30" value="zsnz" aria-label="[*surname/surnames]0"></td>
    <td%mid;><input name="oc" type="number" min="0" class="form-control reset_bd_text" value="zocz" aria-label="[*occ]0"></td>
    <td class="bd_text align-middle">zbdz</td>
    <td%mid;><input name="t" class="form-control" size="30" value="ztz" aria-label="[*note/notes]1"></td>
  </tr>
%end;
%define;one_pvar(zz)
  %if;(e.izz!="" or e.pzz!="")
    %let;datespan;
      <div class="d-flex flex-column justify-content-center" style="line-height: 0.9;">
        %if;pvar.zz.has_birth_date;
          <div aria-label="[*birth date]">° %pvar.zz.slash_birth_date;</div>
        %elseif;pvar.zz.has_baptism_date;
          <div aria-label="[*baptism date]"><span class="text-danger">°</span> %pvar.zz.slash_baptism_date;</div>
        %end;
        %if;pvar.zz.has_death_date;
          <div aria-label="[*death date]">† %pvar.zz.slash_death_date;</div>
        %elseif;pvar.zz.has_burial_date;
          <div aria-label="[*burial date]"><span class="text-danger">†</span> %pvar.zz.slash_burial_date;</div>
        %elseif;pvar.zz.has_cremation_date;
          <div aria-label="[*cremation date]"><span class="text-danger">†</span>%pvar.zz.slash_cremation_date;</div>
        %end;
      </div>
    %in;
    %apply;one_pvar_line("zz", pvar.zz.occ, pvar.zz.first_name, pvar.zz.surname, datespan, e.tzz, "")
    %apply;one_pvar(zz+1)
  %end;
%end;
%define;my_hidden(xx)
  %if;(e.xx!="")<input type="hidden" name="xx" value="%e.xx;">%end;
%end;
<div class="container-xl">
<form id="upd" method="post" action="%action;">
  <div class="h2 m-3">[*add/clear/show/edit the graph]3 RLM</div>
  %hidden;
  <input type="hidden" name="m" value='RLM'>
  %apply;my_hidden("spouse")
  %apply;my_hidden("image")
  %apply;my_hidden("bd")
  %apply;my_hidden("new")
  <div class="table-responsive">
  <table class="table table-hover table-sm w-auto">
    <thead>
      <tr>
        <th scope="col" class="border-top-0"></th>
        <th scope="col" class="border-top-0"></th>
        <th scope="col" class="align-middle font-weight-bold border-left px-3">#</th>
        <th scope="col" class="align-middle pl-2">[*first name/first names]0</th>
        <th scope="col" class="align-middle pl-2">[*surname/surnames]0</th>
        <th scope="col" class="align-middle" style="width:90px">[*occ]1</th>
        <th scope="col" class="align-middle">
          <div class="d-flex flex-column justify-content-center" style="line-height:0.9">
            <div>[*birth]</div>
            <div>[*death]</div>
          </div>
        </th>
        <th scope="col" class="align-middle pl-2">[*text]</th>
      </tr>
    </thead>
    <tbody>
      %apply;one_pvar_line("", "", "", "", "", "", " id='template_line' style='display:none;'")
      %if;(e.i0!="" and e.p0!="")
        %apply;one_pvar(0)
      %else;
        %apply;one_pvar(1)
      %end;
    </tbody>
    <tfoot>
      <td colspan="8" class="text-center p-2">
        <button type="button" class="btn btn-success row_add mr-3"
                title="[*add/insert/delete/up/down row]0">
          <i class="fas fa-plus" aria-hidden="true"></i>
          [*add/insert/delete/up/down row aria-label]0
        </button>
        <input type="submit" class="btn btn-primary"
               value="[*validate/delete]0" title="[*validate form]">
      </td>
    </tfoot>
  </table>
  </div>
  </form>
%if;(not cancel_links)
  %include;trl
  %include;copyr
%end;
</div>
%include;js
%query_time;
<script>
function updateLineNumbers() {
  var lineNumber = 1;
  $('tbody tr:visible:not(.last_row)').each(function() {
    $(this).find('.line-number').text(lineNumber++);
  });
}
function updateArrowVisibility() {
  $('.row_move_up, .row_move_down').css('visibility', 'visible');
  $('tbody tr:visible:first .row_move_up').css('visibility', 'hidden');
  $('tbody tr:last .row_move_down').css('visibility', 'hidden');
  updateLineNumbers();
}
$(document).ready(function() {
  updateArrowVisibility();
});
$(document).on( "click", ".row_add", function() {
  var newRow = $("#template_line").clone().removeAttr("id").removeAttr("style");
  if($(this).closest('tfoot').length) {
    $('tbody').append(newRow.get(0));
  } else {
    $(this).closest("tr").before(newRow.get(0));
  }
  newRow.find('input:first').focus();
  updateArrowVisibility();
});
$(document).on( "click", ".row_del", function() {
  $(this).closest('tr').remove();
  updateArrowVisibility();
});
$(document).on("click", ".row_move_up", function() {
  var row = $(this).closest("tr");
  if(row.index() > 1) {
    row.insertBefore(row.prev());
    updateArrowVisibility();
  }
});
$(document).on("click", ".row_move_down", function() {
  var row = $(this).closest("tr");
  var lastBodyRow = $('tbody tr:visible:last');
  if(!row.is(lastBodyRow)) {
    row.insertAfter(row.next());
    updateArrowVisibility();
  }
});
$(document).on( "change", ".reset_bd_text", function() {
  $(this).closest( "tr" ).children( ".bd_text").html( "" );
});
$("#upd").submit(function(event) {
  event.preventDefault();
  var dataIndex = 1;
  $('tbody tr:visible').each(function() {
    var $row = $(this);
    var firstName = $row.find("input[name='p']").val().trim();
    var lastName = $row.find("input[name='n']").val().trim();
    if(firstName !== "" && lastName !== "") {
      $row.find("input[name='oc']").attr("name", "oc" + dataIndex);
      $row.find("input[name='p']").attr("name", "p" + dataIndex);
      $row.find("input[name='n']").attr("name", "n" + dataIndex);
      $row.find("input[name='t']").attr("name", "t" + dataIndex);
      dataIndex++;
    } else {
      $row.find("input").prop("disabled", true);
    }
  });
  $(this).unbind('submit').submit();
});
</script>
</body>
</html>
